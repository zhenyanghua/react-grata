{"version":3,"sources":["../../src/utils.ts","../../src/index.tsx","../../src/cssom.ts","App.js","index.js"],"names":["random","Math","PREFIX","connect","arr","deriveMsDimension","result","arrayIndex","count","dimension","gap","CustomCss","replaceCustomRows","rows","rowGap","rest","gaps","Array","otherRows","x","size","createStyle","style","document","removeStyle","insertRules","sheet","Error","ClassName","GridBase","props","columns","columnGap","children","className","autoDimensions","maxColumns","maxRows","React","child","row","column","rowSpan","columnSpan","deriveAutoDimensions","newGridTemplate","msRows","msColumns","dynamicRules","gridClass","rules","mergedClassName","useLayoutEffect","Grid","layout","matrix","cells","i","j","cell","id","Object","deriveLayout","layoutById","obj","arrayToObject","assignCellLayout","Cell","cellClass","Header","Code","Example","App","useMediaQuery","query","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.0adfe682.chunk.js","sourcesContent":["import React from 'react'\nimport { CellArea, ColumnsReplacement, RowsReplacement } from './typings'\n\nexport const PREFIX = 'grata'\n\n/**\n * Generate a random 5-character string with concatenated with prefix.\n */\nexport const random = (): string => {\n  const random = Math.random().toString(36).substr(2, 5)\n  return `${PREFIX}-${random}`\n}\n\n/**\n * Join array with a single space\n * @param arr\n * @return string form of array with space as separator.\n */\nexport const connect = (arr: string[]): string => arr.join(' ')\n\n/**\n * Derive the ie 11 columns and rows for grid container.\n * @remarks ie 11 doesn't support gap, but we could fake gap\n * by creating extra track for layout, this behavior should\n * be managed separately for ie 11.\n *\n * ie 11 API reference\n * https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/dev-guides/hh673533(v=vs.85)?redirectedfrom=MSDN\n *\n * @param dimension\n * @param gap\n * @return dimension string literal\n */\nexport const deriveMsDimension = (\n  dimension: string[],\n  gap: string | number\n): string => {\n  const result = []\n  let arrayIndex = 0\n  let count = 0\n  while (count < 2 * dimension.length - 1) {\n    if (count++ % 2 === 0) {\n      result.push(dimension[arrayIndex++])\n    } else {\n      result.push(gap.toString())\n    }\n  }\n  return connect(result)\n}\n\n/**\n * Derive the columns and rows for the grid container.\n * @param children\n * @return {{columns: any[], rows: any[]}}\n */\nexport const deriveAutoDimensions = (\n  children: React.ReactElement | null | undefined\n) => {\n  let maxColumns = 0\n  let maxRows = 0\n\n  if (children) {\n    React.Children.forEach(children, (child) => {\n      const { row = 1, column = 1, rowSpan = 1, columnSpan = 1 } = child.props\n\n      if (row + rowSpan - 1 > maxRows) {\n        maxRows = row + rowSpan - 1\n      }\n      if (column + columnSpan - 1 > maxColumns) {\n        maxColumns = column + columnSpan - 1\n      }\n    })\n  }\n\n  return {\n    columns: Array(maxColumns).fill('1fr'),\n    rows: Array(maxRows).fill('auto')\n  }\n}\n\n/**\n * Convert the layout array to an object\n * [{key}]\n * @param arr\n * @param key\n * @return {{}}\n */\nexport const arrayToObject = (arr: CellArea[], key: string | number) => {\n  const obj = {}\n  arr.forEach((x) => (obj[x[key]] = x))\n  return obj\n}\n\n/**\n * Spread layout from the collection to each cell.\n * @param children\n * @param layout\n * @return {Array<Exclude<*, boolean | null | undefined>>}\n */\nexport const assignCellLayout = (\n  children: React.ReactElement,\n  layout: CellArea[]\n) => {\n  const layoutById = arrayToObject(layout, 'id')\n  return React.Children.map(children, (child) => {\n    return React.cloneElement(child, {\n      ...layoutById[child.props.id],\n      ...child.props\n    })\n  })\n}\n\n/**\n * Matrix rules are:\n * 1. it must describe a complete grid, every cell on the grid must be filled.\n * 2. each area must be a rectangle.\n * 3. each area could only be defined one.\n * 4. empty area could be defined with undefined.\n *\n * Cell row and col id are scanned in\n * the order of how the matrix is scanned.\n * top-left to bottom right.\n * If a cell is already registered, only need\n * to increment the row/col span.\n * If not, register the cell.\n */\nexport const deriveLayout = (matrix: (string | number)[][]) => {\n  const layout = {}\n\n  matrix.forEach((row, i) => {\n    row.forEach((cell, j) => {\n      if (layout[cell]) {\n        if (layout[cell].row === i + 1) {\n          layout[cell].columnSpan++\n        } else if (layout[cell].column === j + 1) {\n          layout[cell].rowSpan++\n        }\n      } else if (cell) {\n        layout[cell] = {\n          id: cell,\n          row: i + 1,\n          column: j + 1,\n          rowSpan: 1,\n          columnSpan: 1\n        }\n      }\n    })\n  })\n\n  return Object.keys(layout).map((id) => layout[id])\n}\n\nexport enum CustomCss {\n  FitHeight = 'fit-height'\n}\n\nexport interface GridReplacement extends RowsReplacement, ColumnsReplacement {}\n\n/**\n * This is the filter chain for any template replacement\n * @param gridReplacement\n */\nexport const replaceCustomGridTemplate = (\n  gridReplacement: GridReplacement\n): GridReplacement => {\n  return replaceCustomRows(gridReplacement)\n}\n\n/**\n * This filter replace the 'fit-height' with the computed value height value\n * so that it occupies the remainder height space of the container.\n * @remarks the requirement for this filter to work is there must be up to\n * one row that define 'fit-height' custom value.\n * @param gridReplacement\n * @example the following sets the first and last row to have a height of\n * '200px', and the second row to occupy the remainder of the height space.\n * `<Grid rows={['200px', 'fit-height', '200px']} {...otherProps} />`\n */\nconst replaceCustomRows = ({\n  rows,\n  rowGap,\n  ...rest\n}: GridReplacement): GridReplacement => {\n  const gaps = Array(rows.length - 1)\n    .fill(rowGap)\n    .join(' - ')\n  let otherRows = '0'\n  if (rows.includes(CustomCss.FitHeight)) {\n    otherRows = rows.filter((x) => x !== CustomCss.FitHeight).join(' - ')\n  }\n  const newRows = rows.map((size) => {\n    if (size === CustomCss.FitHeight) {\n      return `calc(100% - ${otherRows} - ${gaps})`\n    }\n    return size\n  })\n\n  return {\n    rows: newRows,\n    rowGap,\n    ...rest\n  }\n}\n","import React, { ReactElement, useLayoutEffect } from 'react'\nimport {\n  assignCellLayout,\n  connect,\n  deriveAutoDimensions,\n  deriveLayout,\n  deriveMsDimension,\n  random,\n  replaceCustomGridTemplate\n} from './utils'\nimport { CellProps, GridBaseProps, GridProps } from './typings'\nimport { createStyle, insertRules, removeStyle } from './cssom'\n\nexport enum ClassName {\n  GRID = 'grata-grid',\n  CELL = 'grata-cell'\n}\n\n/**\n * ie fake gap by creating extra track for layout, this behavior should\n * be managed separately for ie.\n *\n * @example\n * rows={[\"70px\", \"70px\", \"70px\", \"70px\", \"70px\"]}\n * columns={[\"1fr\", \"1fr\", \"1fr\"]}\n */\nconst GridBase: React.FC<GridBaseProps> = (props) => {\n  let { rows, columns, ...rest } = props\n  const { rowGap = 0, columnGap = 0, children, className } = rest\n\n  const autoDimensions = deriveAutoDimensions(children as ReactElement)\n\n  if (!rows) {\n    rows = autoDimensions.rows\n  }\n  if (!columns) {\n    columns = autoDimensions.columns\n  }\n  // Replace custom css values\n  const newGridTemplate = replaceCustomGridTemplate({\n    rows,\n    columns,\n    rowGap,\n    columnGap\n  })\n\n  rows = newGridTemplate.rows\n  columns = newGridTemplate.columns\n\n  // Account for ie fake gap\n  const msRows = deriveMsDimension(rows, rowGap)\n  const msColumns = deriveMsDimension(columns, columnGap)\n\n  const dynamicRules = `\n    grid-row-gap: ${rowGap};\n    grid-column-gap: ${columnGap};\n    grid-template-rows: ${connect(rows)};\n    grid-template-columns: ${connect(columns)};\n\n    -ms-grid-rows: ${msRows};\n    -ms-grid-columns: ${msColumns};\n  `\n\n  const gridClass = random()\n  const rules = `\n  .${gridClass} {\n    display: grid;\n    display: -ms-grid;\n  ${dynamicRules}\n  }\n `\n  const mergedClassName = `${gridClass} ${className || ClassName.GRID}`\n\n  useLayoutEffect(() => {\n    const style = createStyle()\n    insertRules(style, rules)\n\n    return () => {\n      removeStyle(style)\n    }\n  })\n\n  return <div className={mergedClassName}>{children}</div>\n}\n\nexport const Grid: React.FC<GridProps> = (props) => {\n  let { layout } = props\n  const { children, matrix, ...rest } = props\n\n  let cells = children\n\n  if (matrix) {\n    layout = deriveLayout(matrix)\n  }\n\n  if (layout) {\n    cells = assignCellLayout(children as ReactElement, layout)\n  }\n\n  return React.createElement(GridBase, { ...rest }, cells)\n}\n\nexport const Cell: React.FC<CellProps> = (props) => {\n  const {\n    row,\n    rowSpan = 1,\n    column,\n    columnSpan = 1,\n    children,\n    className\n  } = props\n\n  if (!row || !column) {\n    return null\n  }\n\n  // Account for ie fake gap\n  const msRow = 2 * row - 1\n  const msRowSpan = 2 * rowSpan - 1\n  const msColumn = 2 * column - 1\n  const msColumnSpan = 2 * columnSpan - 1\n\n  const dynamicRules = `\n    grid-row: ${row} / span ${rowSpan};\n    grid-column: ${column} / span ${columnSpan};\n\n    -ms-grid-row: ${msRow};\n    -ms-grid-row-span: ${msRowSpan};\n    -ms-grid-column: ${msColumn};\n    -ms-grid-column-span: ${msColumnSpan};\n  `\n  const cellClass = random()\n  const rules = `\n  .${cellClass} {\n  ${dynamicRules}\n  }`\n  const mergedClassName = `${cellClass} ${className || ClassName.CELL}`\n\n  useLayoutEffect(() => {\n    const style = createStyle()\n    insertRules(style, rules)\n    return () => {\n      removeStyle(style)\n    }\n  })\n\n  return <div className={mergedClassName}>{children}</div>\n}\n","// todo - reuse one style element for all.\n\nexport const createStyle = (): HTMLStyleElement => {\n  const style = document.createElement('style')\n  document.head.appendChild(style)\n  return style\n}\n\nexport const removeStyle = (style: HTMLStyleElement) => {\n  if (style) {\n    document.head.removeChild(style)\n  }\n}\n\nexport const insertRules = (style: HTMLStyleElement, rules: string) => {\n  const sheet = style.sheet as CSSStyleSheet\n  if (!sheet) {\n    throw new Error('Failed to find CSSStyleSheet from the style element')\n  }\n\n  sheet.insertRule(rules, sheet.cssRules.length)\n}\n","import React from 'react'\nimport { Grid, Cell } from 'react-grata'\nimport { useMediaQuery } from 'react-responsive'\n\nimport './App.css'\n\nconst Header = () => (\n  <>\n    <h1>react-grata</h1>\n    <small>Light weight react grid layout component that support IE 11. What you draw is what you get.</small>\n  </>\n)\n\nconst Code = () => (\n  <pre>\n    {`\n    const App = () => {\n      const matrix = [\n        [1, 1, 1],\n        [2, 3, 3],\n        [2, 5, 6],\n        [7, 7, 6],\n        [8, 8, 8],\n      ];\n\n      return (\n        <Grid rowGap=\"12px\" \n              columnGap=\"12px\" \n              matrix={matrix}\n              rows={['2rem', '2rem', 'fit-height', '2rem', '2rem']}>\n          <Cell id={1}>1</Cell>\n          <Cell id={2}>2</Cell>\n          <Cell id={3}>3</Cell>\n          <Cell id={5}>5</Cell>\n          <Cell id={6}>6</Cell>\n          <Cell id={7}>7</Cell>\n          <Cell id={8}>8</Cell>\n        </Grid>\n      );\n    }`}\n  </pre>\n)\n\nconst Example = () => {\n  const matrix = [\n    [1, 1, 1],\n    [2, 3, 3],\n    [2, 5, 6],\n    [7, 7, 6],\n    [8, 8, 8],\n  ];\n  const rowGap = \"12px\";\n  const columnGap = \"12px\";\n\n  return (\n    <Grid className=\"grid-inside\"\n          rowGap={rowGap}\n          columnGap={columnGap}\n          matrix={matrix}\n          rows={['2rem', '2rem', 'fit-height', '2rem', '2rem']}>\n      <Cell id={1}>1</Cell>\n      <Cell id={2}>2</Cell>\n      <Cell id={3}>3</Cell>\n      <Cell id={5}>5</Cell>\n      <Cell id={6}>6</Cell>\n      <Cell id={7}>7</Cell>\n      <Cell id={8}>8</Cell>\n    </Grid>\n  );\n}\nconst App = () => {\n\n  const isMobile = useMediaQuery({ query: '(max-width: 500px)' });\n  const matrixMobile = [\n    ['hd'],\n    ['cd'],\n    ['eg'],\n  ];\n  const matrixOthers = [\n    ['hd', 'hd'],\n    ['cd', 'eg'],\n  ];\n  const matrix = isMobile ? matrixMobile : matrixOthers;\n\n  return (\n    <Grid className=\"grid-outside\"\n          rowGap=\"10px\"\n          columnGap=\"10px\"\n          matrix={matrix}>\n      <Cell className=\"cell\" id=\"hd\">\n        <Header/>\n      </Cell>\n      <Cell className=\"cell\" id=\"cd\">\n        <Code/>\n      </Cell>\n      <Cell className=\"cell\" id=\"eg\">\n        <Example/>\n      </Cell>\n    </Grid>\n  )\n}\n\nexport default App\n","import 'react-app-polyfill/ie11'\nimport 'react-app-polyfill/stable'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport './index.css'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}